$(function(){var g=new Swiper(".swiper-container",{slidesPerView:"auto",spaceBetween:0,freeMode:!0,watchSlidesProgress:!0,watchSlidesVisibility:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},observer:!0,observeParents:!0,observeSlideChildren:!0,mousewheel:{sensitivity:.3},grabCursor:!0}),e={iframe_tab_container:$("#iframe-tab-container"),iframe_tab:$("#iframe-tab"),iframe_tab_link:$("#iframe-tab .nav-link"),iframe_tabContent:$("#iframe-tabContent"),item_close:$(".iframe-tab-close-btn"),
    menu_link:$(".main-menu .nav-link:not(.navbar-header .nav-link)"),menu_content:$(".main-menu-content .sidebar"),drop_menu_link:$(".dropdown-menu .dropdown-item"),drop_menu:$(".dropdown-menu")},h={tabItem:function(a,b){var c="",f="data-first=1";if(2>=arguments.length||void 0===arguments[2]||arguments[2])c='<span title="\u5173\u95ed\u6807\u7b7e\u9875" class="iframe-tab-close-btn"><i class="fa fa-minus-circle"></i></span>',f="data-first=0";return'\n            <li class="nav-item swiper-slide" role="presentation">\n                    <a '+
        f+' class="nav-link active" id="iframe-home-'+b+'" data-toggle="pill" href="#iframe-'+b+'" role="tab" aria-controls="iframe-'+b+'" aria-selected="true">\n                        '+a+"\n                        "+c+"\n                    </a>\n            </li>\n            "},tabContentItem:function(a,b){return'\n            <div class="tab-pane fade show active" id="iframe-'+b+'" role="tabpanel" aria-labelledby="iframe-home-'+b+'">\n                <iframe\n                        style="position: absolute;width: 100%;height: 100%;left: 0;top: 0;right: 0;bottom: 0;"\n                        src="'+
        a+'" width="100%" height="100%" frameborder="no" border="0" marginwidth="0"\n                        marginheight="0"\n                        scrolling-x="no" scrolling-y="auto" allowtransparency="yes"></iframe>\n            </div>\n            '}},d={TAB_STORAGE_KEY:$("#use_id").val()+"_6d9e562706a26cd2",CLICK_TAB:"",USE_CACHE:parseInt($("#iframe_tab_cache").val()),storageGet:function(){var a=localStorage.getItem(this.TAB_STORAGE_KEY);return null===JSON.parse(a)?{}:JSON.parse(a)},storageSet:function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   b){var c=this.storageGet();c[a]=b;a=JSON.stringify(c);localStorage.setItem(this.TAB_STORAGE_KEY,a);return c},storageDelete:function(a){var b=this.storageGet();b[a]&&(delete b[a],localStorage.setItem(this.TAB_STORAGE_KEY,JSON.stringify(b)));return b},storageDeleteAll:function(){localStorage.removeItem(this.TAB_STORAGE_KEY)},clearDefaultMenuEvent:function(){e.menu_link.unbind("click");e.drop_menu_link.unbind("click");$(".navbar-header").find("a").unbind("click");var a=e.menu_content.find("li");a.find("a").click(function(b){var c=
        $(this).attr("href");c&&"#"!==c&&(b.preventDefault(),a.find(".nav-link").removeClass("active"),$(this).addClass("active"))});e.drop_menu.find(".dropdown-item").click(function(b){var c=$(this).attr("href");c&&"#"!==c&&b.preventDefault()})},menuClick:function(){e.menu_content.find("li").find("a").click(d.menuClickCallback);e.drop_menu.find("a").click(d.menuClickCallback);$(".navbar-header").find("a").click(function(){location.href=$(this).attr("href")})},menuClickCallback:function(){var a=$(this).html(),
        b=$(this).attr("href"),c=d.generateID(b);if(b&&"#"!==b)if(-1!==b.indexOf("logout"))location.href=b;else{a=h.tabItem(a,c);b=h.tabContentItem(b,c);var f=d.findIframeTabActiveElement();d.removeTabBarStyle();d.cacheUpdateTabBar(f);0>=e.iframe_tab.find("#iframe-home-"+c).length?(g.appendSlide(a),e.iframe_tabContent.append(b),a=$("#iframe-home-"+c),b=a.parents(".nav-item").index(),c=$("#iframe-"+c),g.slideTo(b),g.updateSlides(),a.addClass("active"),a.attr("aria-selected","true"),c.addClass("active"),c.addClass("show"),
        d.cacheUpdateTabBar(a)):e.iframe_tab.find("#iframe-home-"+c).click()}},joinFirstMenu:function(){var a=$(e.menu_link[0]).html(),b=$(e.menu_link[0]).attr("href"),c=this.generateID(b);g.appendSlide(h.tabItem(a,c,!1));e.iframe_tabContent.append(h.tabContentItem(b,c));g.updateSlides()},removeTabBarStyle:function(){e.iframe_tab.find(".nav-link").removeClass("active");e.iframe_tab.find(".nav-link").attr("aria-selected","false");e.iframe_tabContent.find(".tab-pane").removeClass("active","show")},closeAdjacentOperate:function(a){a.find(".nav-link").click();
        d.removeTabBarStyle();a.find(".nav-link").addClass("active");a.find(".nav-link").attr("aria-selected","true");a=a.find(".nav-link").attr("href");e.iframe_tabContent.find(a).addClass("active");e.iframe_tabContent.find(a).addClass("show")},iframeTabEventRegister:function(){$(document).on("click",".iframe-tab-close-btn",function(a){if("1"!==$(this).parents(".nav-link").attr("data-first")){var b=$(this).parents(".nav-item");if($(this).parents(".nav-link").hasClass("active")){var c=b.next(),f=b.prev();
        0<c.length?d.closeAdjacentOperate(c):d.closeAdjacentOperate(f)}c=$($(this).parents(".nav-link").attr("href"));b.remove();c.remove();1===d.USE_CACHE&&d.storageDelete($(this).parents(".nav-link").attr("id").split("-").pop());a.stopPropagation()}});$(document).on("dblclick","#iframe-tab .nav-link",function(a){$(this).find(".iframe-tab-close-btn").click();return!1});$(document).on("click","#iframe-tab .nav-link",function(){var a=$(this).attr("href"),b=$(""+a);d.linkMenuAndIframeTab(a);$(this).addClass("active");
        $(this).attr("aria-selected","true");b.addClass("active");b.addClass("show");a=$(this).parents(".nav-item").index();g.slideTo(a);g.updateSlides();d.cacheUpdateTabBar($(this))});$(document).on("hidden.bs.tab","#iframe-tab .nav-link",function(a){d.cacheUpdateTabBar($(a.target))});$(document).on("mousedown","#iframe-tab .nav-link",function(a){document.oncontextmenu=function(){return!1};if(3===a.which){var b=a.clientX;a=a.clientY;$(".mouse-click-menu").show().css({left:b,top:a});d.CLICK_TAB=$(this)}})},
    rightClickEventRegister:function(){$(document).on("click",".tab-copy-link",function(){if(""!==d.CLICK_TAB){var a=d.CLICK_TAB.attr("href");a=$(a+">iframe").attr("src");var b=$("<input>");$("body").append(b);b.val(a).select();document.execCommand("copy");b.remove();$(this).tooltip("show");Dcat.success("\u590d\u5236\u6210\u529f")}document.oncontextmenu=function(){return!0}});$(document).on("click",".tab-open-link",function(){if(""!==d.CLICK_TAB){var a=d.CLICK_TAB.attr("href");a=$(a+">iframe").attr("src");
        window.open(a)}document.oncontextmenu=function(){return!0}});$(document).on("click",".tab-close-all",function(){""!==d.CLICK_TAB&&e.iframe_tab.find(".nav-link").each(function(){"1"!==$(this).attr("data-first")&&$(this).find(".iframe-tab-close-btn").click()});document.oncontextmenu=function(){return!0}});$(document).on("click",".tab-close-other",function(){""!==d.CLICK_TAB&&e.iframe_tab.find(".nav-link").each(function(){"1"!==$(this).attr("data-first")&&(d.CLICK_TAB.attr("id")===$(this).attr("id")?
        d.CLICK_TAB.click():(d.cacheUpdateTabBar($(this)),$(this).find(".iframe-tab-close-btn").click()))});document.oncontextmenu=function(){return!0}});$(document).on("click",".tab-clear-cache",function(){d.storageDeleteAll();Dcat.success("\u7f13\u5b58\u5df2\u6e05\u7a7a");e.iframe_tab.html("");e.iframe_tabContent.html("");d.joinFirstMenu();e.menu_content.find(".nav-link.active").removeClass("active");$(e.menu_link[0]).addClass("active");document.oncontextmenu=function(){return!0}});$(document).on("click",
        ".tab-refresh",function(){if(""!==d.CLICK_TAB){var a=$(d.CLICK_TAB.attr("href")+">iframe"),b=a.attr("src");a.attr("src","");a.attr("src",b);Dcat.success("\u9875\u9762\u5df2\u5237\u65b0")}document.oncontextmenu=function(){return!0}});$(document).on("click",function(){document.oncontextmenu=function(){return!0};$(".mouse-click-menu").hide()})},cacheInit:function(){if(0===this.USE_CACHE)this.storageDeleteAll();else{var a=this.storageGet();if(0!==a.length){d.removeTabBarStyle();for(var b in a)g.appendSlide(a[b].tab_html),
        e.iframe_tabContent.append(a[b].tab_content_html);0>=d.findIframeTabActiveElement().length&&(a=$(e.menu_link[0]).attr("href"),a=this.generateID(a),$("#iframe-home-"+a).click());a=d.findIframeTabActiveElement().attr("href");d.linkMenuAndIframeTab(a)}}},cacheUpdateTabBar:function(a){if(1===this.USE_CACHE&&"1"!==a.attr("data-first")){var b=a.attr("id").split("-").pop();a=a.parents("li").prop("outerHTML");var c=$("#iframe-"+b).prop("outerHTML");this.storageSet(b,{id:b,tab_html:a,tab_content_html:c})}},
    findIframeTabActiveElement:function(){return e.iframe_tab.find(".nav-link.active")},linkMenuAndIframeTab:function(a){var b=$(a+">iframe").attr("src"),c=e.menu_content.find("li");c.find("a").each(function(){var f=$(this).attr("href");f&&"#"!==f&&f===b&&(c.find(".nav-link").removeClass("active"),$(this).addClass("active"),f=$(this).parents(".has-treeview"),0<f.length&&!f.hasClass("menu-open")&&f.find("a[href='#']").click())})},init:function(){this.clearDefaultMenuEvent();this.joinFirstMenu();this.menuClick();
        this.cacheInit();this.iframeTabEventRegister();this.rightClickEventRegister();this.darkMode()},darkMode:function(){"dark"===(window.parent.localStorage||{setItem:function(){},getItem:function(){}}).getItem("dcat-admin-theme-mode")&&e.iframe_tab_container.addClass("sidebar-dark-white");$(document).on("dark-mode.shown",function(){e.iframe_tab_container.addClass("sidebar-dark-white")});$(document).on("dark-mode.hide",function(){e.iframe_tab_container.removeClass("sidebar-dark-white")})},generateID:function(a){return md5(a+
        this.TAB_STORAGE_KEY).substr(8,16)}};window.iframeTabParent={swiper:g,elements:e,iframeTabTemplate:h,iframeTab:d};d.init()});